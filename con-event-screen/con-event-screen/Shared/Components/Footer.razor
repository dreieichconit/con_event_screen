@using con_event_services.Interfaces
@using con_event_db.Repositories
@using System.Linq;
@using System.Text
@inherits LayoutComponentBase
@inject IStateController Controller


<MudPaper Elevation="0" class="d-flex flex-row justify-content-between footer">
    <div class="marquee-bar">
        @Marquee
    </div>
</MudPaper>

@code {
    
    public MarkupString Marquee { get; set; }
    
    protected override async Task OnInitializedAsync()
    {
        UpdateMarquee(null, EventArgs.Empty);
        Controller.MarqueeUpdated += UpdateMarquee;
    }

    private void UpdateMarquee(object? e, EventArgs? ee)
    {
        Marquee = GenerateMarkup();
        InvokeAsync(StateHasChanged);
    }

    private MarkupString GenerateMarkup()
    {
        var sb = new StringBuilder();

        sb.AppendLine("<marquee behavior=\"scroll\" direction=\"left\" scrollamount=\"10\">");

        sb.AppendLine("<p>");

        sb.AppendLine(string.Join(" // ", MarqueeRepository.Get().Select(x => x.Text)));
        
        sb.AppendLine("</p>");
        
        sb.AppendLine("</marquee>");

        return new MarkupString(sb.ToString());
    }
}